- name: Remove Windows user and delete profile
  hosts: all
  gather_facts: no
  become: false
  collections:
    - ansible.windows

  vars:
    username: "guest"  # Altere para o nome do usuário a ser removido

  tasks:
    - name: Remove user account
      ansible.windows.win_user:
        name: "{{ username }}"
        state: absent

    - name: Delete user profile from disk
      ansible.windows.win_command: >
        cmd.exe /c "wmic path win32_userprofile where name='{{ username }}' delete"
      register: profile_removal
      failed_when: false  # Evita falha se o perfil já estiver ausente

    - name: Mostrar resultado
      ansible.builtin.debug:
        var: profile_removal.stdout_lines

